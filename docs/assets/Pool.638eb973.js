import{d as Ee,r as m,z as Ae,a as ze,H as Be,I as Pe,B as Le,b as f,c as d,w as o,o as e,e as u,f as P,q as M,t as D,h as l,x as ae,g as R,v as j,n as v,k as n,C as x,D as T,E as Me,l as Se,J as G,m as B}from"./index.781fe319.js";import{c as Ie,p as ie,i as re,j as Ne,t as He,k as Re,s as te,D as je}from"./index.c2847454.js";import{A as ve}from"./Aperture.f5a29855.js";const Ke=P("h2",null,"\u89D2\u8272\u6B66\u5668\u5361\u6C60\u4FE1\u606F",-1),Ue={key:0,style:{width:"4rem"}},Ve={key:1},qe={key:0,style:{display:"flex"}},Oe={key:1},Je={key:2},Ye={key:0,style:{display:"flex"}},Ge={key:1},Qe=["innerHTML","onClick"],We=["innerHTML","onClick"],Xe={key:5},Ze=["href"],et={key:1},tt={key:6},lt={key:0},nt={key:0},ot={key:1},ut=["innerHTML"],st=["innerHTML","onClick"],at={key:3},_t=Ee({__name:"Pool",setup(it){const $=m(Ie()),g=m(!1),le=Ae(),me=ze(),ce=Be(),E=m(!0);$.value?ie:ie.splice(2,1);const pe=m(ie);$.value?re:re.splice(2,1);const _e=m(re),fe=m(Ne);let K=m([]),U=m("");const he=t=>{K.value=t},ge=t=>{U.value=t};let F=m(!0),Q=m(""),W=m(-2),ke=m(He);const Ce=t=>{W.value=t,I(1)},we=t=>{Q.value=t},be=t=>{I(1)};let V=m({pageNum:1,pageSize:200}),X=m(0),q=m([]),S=m([]),C=m(`
    ${$.value?"margin: 20px;":"margin:2px;"}
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  `);const xe=[t=>t.type!=2,t=>t.type!=1,t=>t.type!=2&&t.star!=4,t=>t.type!=2&&t.star!=5];let ne=Pe(()=>{if(S.value.length<1)return[];let t=[...S.value];for(let p=0;p<K.value.length;++p)t=t.filter(a=>xe[K.value[p]](a));if(U.value){let p=U.value;t=t.filter(a=>a.name.includes(p)||a.version==p||a.count==p)}return console.log(t,"tmpTable1"),t});const Te=()=>{W.value=-2,Q.value="",I(1)},$e=()=>{K.value=[],U.value=""},Fe=t=>{V.value.pageSize=t,I(1)},ye=(t,p=!1)=>{let a=`${t.version}\u7248\u672C `+(p?`${t.version_name||""} ${t.name||""}`:`${t.name} ${t.up_5||""}`);ce.success({title:"\u5361\u6C60\u4FE1\u606F",content:()=>[B("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},{default:()=>[B("a",{href:t.pool_img,target:"_blank"},{default:()=>`\u5361\u6C60\u56FE\u7247: ${a}`}),B(G,{src:t.pool_img,imgProps:{style:{width:"100%"}},style:{marginTop:"10px",width:"390px",aspectRatio:2},objectFit:"contain"},{default:()=>B("")})]})],positiveText:"\u786E\u5B9A",onPositiveClick:()=>{}})},De=t=>{ce.success({title:"\u7248\u672C\u4FE1\u606F",content:()=>[B("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},{default:()=>[B("a",{href:t.version_img,target:"_blank"},{default:()=>`\u7248\u672C\u56FE\u7247: ${t.version_name}  ${t.version_remark?`(${t.version_remark})`:""}`}),B(G,{src:t.version_img,imgProps:{style:{width:"100%"}},style:{marginTop:"10px",width:"390px",aspectRatio:2},objectFit:"contain"},{default:()=>B("")})]})],positiveText:"\u786E\u5B9A",onPositiveClick:()=>{}})},Z=(t,p)=>{if(!t||!p)return"\u65E0";let a=new Date(p).getTime(),O=new Date(t).getTime();return p=="now"&&(a=new Date().getTime()),Math.ceil((a-O)/je)},oe=async()=>{le.start(),g.value=!0;let t={search:Q.value,type:W.value,page:V.value},{code:p,data:a,msg:O}=await Re(t);if(p!=200){me.error(O),setTimeout(()=>{le.finish()},500),g.value=!1;return}if(X.value=a.total,console.log(a==null?void 0:a.records,"??"),q.value=a==null?void 0:a.records.map(i=>{i.pool_stage=`\u7B2C${i.pool_index}\u6C60${i.stage}\u671F`;let y=[],A=[],z=[],b=[];return i.up5[1].map(h=>{var w,r;y.push(h.icon_url),z.push(Z((w=h.last_up)==null?void 0:w.pool_start,(r=h.now_up)==null?void 0:r.pool_start))}),i.up5_day2last=z.join(" "),i.up5_imgs=y,i.up4_imgs=i.up4[1].map(h=>{var w,r;A.push(h.icon_url),b.push(Z((w=h.last_up)==null?void 0:w.pool_start,(r=h.now_up)==null?void 0:r.pool_start))}),i.up4_day2last=b.join(" "),i.up4_imgs=A,i.version_info=`<font color='#18a058'>${i.version_name}</font><div>(${i.version_start} ~ ${i.version_end})</div>`,i.pool_info=`<font color='#18a058'>${i.name}</font><div>(${i.pool_start} ~ ${i.pool_end})</div>`,i.up5_count=i.up5[0],i.up4_count=i.up4[0],i}),S.value.length==0){let i=te.get("genshinPoolCalcTable");if(i)S.value=i;else{let y={...a.roleCalc,...a.weaponCalc};console.log(y,"calcRecords");let A={},z=Object.keys(y),b=Object.values(y),h=[],w={};for(let r=0;r<a.records.length;++r){let _=a.records[r],L=`${_.version}_${_.stage}_${_.type}`;A[L]||(A[L]=_.pool_img)}for(let r=0;r<b.length;++r){if(w=b[r],w.count==0||!w.now_up)continue;let{now_up:_,last_up:L,icon_url:ee,star:N,type:J,count:Y}=w;`${_.version}${_.stage}${J}`;let s={id:_.id,name:z[r],item_img:ee,day2last:Z(L.pool_start,_.pool_start),day2now:Z(_.pool_start,"now"),count:Y,star:N,type:J,version:_.version,pool_start:_.pool_start,itemInfo:`<font color='${N>4?"#fcb040":"#8a2be2"}'>${z[r]}</font><div>${N}\u661F${J>1?"\u6B66\u5668":"\u89D2\u8272"}</div>`,pool_info:`<font color='#18a058'>${_.name}</font><div>(${_.pool_start} ~ ${_.pool_end})</div>`,pool_img:_.pool_img,version_name:_.name};h.push(s)}h.sort((r,_)=>r.day2now<=_.day2now?1:-1),S.value=[...h],te.set("genshinPoolCalcTable",S.value.map(r=>({name:r.name,star:r.star,type:r.type,version:r.version,pool_start:r.pool_start,count:r.count})))}}setTimeout(()=>{le.finish()},500),g.value=!1},de=()=>{te.remove("genshinPool"),te.remove("genshinPoolCalcTable"),oe();try{window.location.reload()}catch{}},I=async t=>{V.value.pageNum=t,q.value=[],X.value=0,oe()};return Le(async()=>{oe()}),(t,p)=>{const a=f("n-skeleton"),O=f("n-gradient-text"),i=f("n-layout-header"),y=f("n-space"),A=f("n-select"),z=f("n-input"),b=f("n-button"),h=f("n-radio-button"),w=f("n-radio-group"),r=f("n-divider"),_=f("n-table"),L=f("n-icon"),ee=f("n-empty"),N=f("n-layout-content"),J=f("n-pagination"),Y=f("n-layout");return e(),d(Y,null,{default:o(()=>[u(i,{class:"header-top"},{default:o(()=>[P("div",null,[Ke,g.value?(e(),d(a,{key:0,width:150,sharp:!1,size:"medium"})):(e(),d(O,{key:1,gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:o(()=>[M(" \u5171"+D(l(X))+"\u4E2A\uFF0C\u5DF2\u5C55\u793A"+D(E.value?l(q).length:l(ne).length)+"\u4E2A ",1)]),_:1},8,["gradient"]))]),g.value?(e(),d(a,{key:0,width:300,sharp:!1,size:"medium"})):ae("",!0)]),_:1}),u(Y,null,{default:o(()=>[u(i,null,{default:o(()=>[g.value?R((e(),d(y,{key:0,style:v(l(C))},{default:o(()=>[(e(!0),n(T,null,x(new Array(8),(s,k)=>(e(),d(a,{key:k,width:200,sharp:!1,size:"medium"}))),128))]),_:1},8,["style"])),[[j,l(F)]]):!g.value&&E.value?R((e(),d(y,{key:1,class:"space-main",style:v(l(C))},{default:o(()=>[u(A,{value:l(W),"onUpdate:value":Ce,options:l(ke),style:v($.value?"width: 200px":"min-width: 200px;")},null,8,["value","options","style"]),u(z,{value:l(Q),onKeyup:Me(be,["enter"]),"onUpdate:value":we,type:"text",placeholder:"\u641C\u7D22\u7269\u54C1\u540D\u79F0/\u7248\u672C/\u5361\u6C60\u540D",style:v($.value?"width: 200px":"min-width: 200px;")},null,8,["value","onKeyup","style"]),u(y,{style:v($.value?"flex:1;":"min-width: 200px;")},{default:o(()=>[u(b,{type:"success",style:{width:"84px"},onClick:p[0]||(p[0]=s=>I(1))},{default:o(()=>[M("\u641C\u7D22")]),_:1}),u(b,{type:"warning",onClick:Te},{default:o(()=>[M("\u91CD\u7F6E\u6761\u4EF6")]),_:1}),u(b,{type:"info",style:{width:"84px"},onClick:de},{default:o(()=>[M("\u5237\u65B0\u7F13\u5B58")]),_:1})]),_:1},8,["style"])]),_:1},8,["style"])),[[j,l(F)]]):!g.value&&!E.value?R((e(),d(y,{key:2,class:"space-main",style:v(l(C))},{default:o(()=>[u(A,{placeholder:"\u9009\u62E9\u8FC7\u6EE4\u7684\u7269\u54C1\u7C7B\u578B",multiple:"","max-tag-count":"responsive",value:l(K),"onUpdate:value":he,options:fe.value,style:v($.value?"width: 200px":"min-width: 200px;")},null,8,["value","options","style"]),u(z,{value:l(U),"onUpdate:value":ge,type:"text",placeholder:"\u641C\u7D22\u540D\u79F0/\u7248\u672C\u53F7/up\u6B21\u6570",style:v($.value?"width: 200px":"min-width: 200px;")},null,8,["value","style"]),u(y,{style:v($.value?"flex:1;":"min-width: 200px;")},{default:o(()=>[u(b,{type:"warning",onClick:$e},{default:o(()=>[M("\u91CD\u7F6E\u6761\u4EF6")]),_:1}),u(b,{type:"info",style:{width:"84px"},onClick:de},{default:o(()=>[M("\u5237\u65B0\u7F13\u5B58")]),_:1})]),_:1},8,["style"])]),_:1},8,["style"])),[[j,l(F)]]):ae("",!0),u(y,{style:v([l(C),{margin:"10px 2px !important"}])},{default:o(()=>[u(w,{value:E.value,"onUpdate:value":p[1]||(p[1]=s=>E.value=s),name:"radiobuttongroup1"},{default:o(()=>[u(h,{value:!0,label:"\u5361\u6C60\u6570\u636E\u8868"}),u(h,{value:!1,label:"\u7EDF\u8BA1\u6570\u636E\u8868"})]),_:1},8,["value"])]),_:1},8,["style"]),$.value?ae("",!0):(e(),d(r,{key:3,onClick:p[2]||(p[2]=s=>Se(F)?F.value=!l(F):F=!l(F))},{default:o(()=>[M(D(l(F)?"\u6536\u8D77\u641C\u7D22":"\u5C55\u5F00\u641C\u7D22"),1)]),_:1}))]),_:1}),R(u(N,{"has-sider":"","content-style":{overflow:"scroll"}},{default:o(()=>[g.value?(e(),d(y,{key:0,style:v(l(C))},{default:o(()=>[(e(!0),n(T,null,x(new Array(20),(s,k)=>(e(),n("div",{key:k},[u(a,{width:100,height:123,sharp:!1,size:"medium"})]))),128))]),_:1},8,["style"])):!g.value&&l(q).length>0?(e(),d(y,{key:1,style:v(l(C))},{default:o(()=>[u(_,{striped:""},{default:o(()=>[P("thead",null,[P("tr",null,[(e(!0),n(T,null,x(pe.value,(s,k)=>(e(),n("td",{key:k},D(s.label),1))),128))])]),P("tbody",null,[(e(!0),n(T,null,x(l(q),(s,k)=>(e(),n("tr",{key:k},[(e(!0),n(T,null,x(pe.value,(c,ue)=>(e(),n("td",{key:ue},[c.key=="pool_stage"?(e(),n("div",Ue,D(s[c.key]),1)):c.key=="up5_imgs"?(e(),n("div",Ve,[s[c.key].length>0?(e(),n("div",qe,[(e(!0),n(T,null,x(s[c.key],(H,se)=>(e(),d(l(G),{style:{"margin-right":"0.3rem","border-radius":"5px"},width:48,height:48,"preview-disabled":!1,lazy:"",src:H,key:se},null,8,["src"]))),128))])):(e(),n("div",Oe,"-"))])):c.key=="up4_imgs"?(e(),n("div",Je,[s[c.key].length>0?(e(),n("div",Ye,[(e(!0),n(T,null,x(s[c.key],(H,se)=>(e(),d(l(G),{style:{"margin-right":"0.3rem","border-radius":"5px"},width:48,height:48,"preview-disabled":!1,lazy:"",src:H,key:se},null,8,["src"]))),128))])):(e(),n("div",Ge,"-"))])):c.key=="pool_info"?(e(),n("div",{key:3,innerHTML:s[c.key],style:{width:"10.5rem"},onClick:H=>ye(s)},null,8,Qe)):c.key=="version_info"?(e(),n("div",{key:4,innerHTML:s[c.key],style:{width:"13rem"},onClick:H=>De(s)},null,8,We)):["remark","link","preview"].includes(c.key)?(e(),n("div",Xe,[s[c.key]?(e(),n("a",{key:0,href:s[c.key],target:"_blank"},D(c.label),9,Ze)):(e(),n("div",et,"-"))])):(e(),n("div",tt,D(s[c.key]),1))]))),128))]))),128))])]),_:1})]),_:1},8,["style"])):(e(),d(y,{key:2,style:v([{width:"100%"},l(C)])},{default:o(()=>[u(ee,{description:"\u6240\u9009\u6761\u4EF6\u7684\u6570\u636E\u4E3A\u7A7A"},{icon:o(()=>[u(L,null,{default:o(()=>[u(l(ve))]),_:1})]),_:1})]),_:1},8,["style"]))]),_:1},512),[[j,E.value]]),R(u(Y,{"content-style":"overflow-x: scroll;"},{default:o(()=>[g.value?(e(),d(y,{key:0,style:v(l(C))},{default:o(()=>[u(a,{width:300,sharp:!1,size:"medium"})]),_:1},8,["style"])):(e(),d(y,{key:1,style:v(l(C))},{default:o(()=>[u(J,{page:l(V).pageNum,"page-size":l(V).pageSize,"item-count":l(X),"on-update:page":I,"show-size-picker":"","page-sizes":[20,50,100,150,200,300],"on-update:page-size":Fe},null,8,["page","page-size","item-count"])]),_:1},8,["style"]))]),_:1},512),[[j,E.value]]),R(u(N,{"has-sider":"","content-style":{overflow:"scroll"}},{default:o(()=>[g.value?(e(),d(y,{key:0,style:v(l(C))},{default:o(()=>[(e(!0),n(T,null,x(new Array(20),(s,k)=>(e(),n("div",{key:k},[u(a,{width:100,height:123,sharp:!1,size:"medium"})]))),128))]),_:1},8,["style"])):!g.value&&l(ne).length>0?(e(),d(y,{key:1,style:v(l(C))},{default:o(()=>[u(_,{striped:""},{default:o(()=>[P("thead",null,[P("tr",null,[(e(!0),n(T,null,x(_e.value,(s,k)=>(e(),n("td",{key:k},D(s.label),1))),128))])]),P("tbody",null,[(e(!0),n(T,null,x(l(ne),(s,k)=>(e(),n("tr",{key:k},[(e(!0),n(T,null,x(_e.value,(c,ue)=>(e(),n("td",{key:ue},[c.key=="item_img"?(e(),n("div",lt,[s[c.key]?(e(),n("div",nt,[u(l(G),{width:48,height:48,"preview-disabled":!1,lazy:"",src:s[c.key]},null,8,["src"])])):(e(),n("div",ot,"-"))])):c.key=="itemInfo"?(e(),n("div",{key:1,innerHTML:s[c.key]},null,8,ut)):c.key=="pool_info"?(e(),n("div",{key:2,innerHTML:s[c.key],style:{width:"10.5rem"},onClick:H=>ye(s,!0)},null,8,st)):(e(),n("div",at,D(s[c.key]),1))]))),128))]))),128))])]),_:1})]),_:1},8,["style"])):(e(),d(y,{key:2,style:v([{width:"100%"},l(C)])},{default:o(()=>[u(ee,{description:"\u6240\u9009\u6761\u4EF6\u7684\u6570\u636E\u4E3A\u7A7A"},{icon:o(()=>[u(L,null,{default:o(()=>[u(l(ve))]),_:1})]),_:1})]),_:1},8,["style"]))]),_:1},512),[[j,!E.value]])]),_:1})]),_:1})}}});export{_t as default};
